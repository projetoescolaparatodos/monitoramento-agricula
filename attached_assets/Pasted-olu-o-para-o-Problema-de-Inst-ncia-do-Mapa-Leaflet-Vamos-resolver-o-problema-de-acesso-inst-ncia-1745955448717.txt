olu칞칚o para o Problema de Inst칙ncia do Mapa Leaflet
Vamos resolver o problema de acesso  inst칙ncia do mapa e a inicializa칞칚o duplicada que ocorre quando voc칡 tenta adicionar marcadores.

An치lise do Problema
O erro ocorre porque:

Voc칡 est치 tentando criar uma nova inst칙ncia do mapa quando uma j치 existe

O sistema n칚o est치 conseguindo acessar a inst칙ncia existente corretamente

A refer칡ncia ao mapa est치 sendo perdida entre os componentes

Solu칞칚o Completa
1. Gerenciamento Centralizado da Inst칙ncia do Mapa
typescript
// Crie um hook personalizado para gerenciar a inst칙ncia do mapa
import { useEffect, useRef } from 'react';
import L from 'leaflet';

export function useMapInstance(containerId: string) {
  const mapInstance = useRef<L.Map | null>(null);

  useEffect(() => {
    const container = document.getElementById(containerId);
    if (!container) return;

    // Verifica se j치 existe um mapa no container
    if (container._leaflet_id) {
      mapInstance.current = L.Map.get(container._leaflet_id);
      return;
    }

    // Cria nova inst칙ncia se n칚o existir
    mapInstance.current = L.map(container, {
      center: [-15.788, -47.879],
      zoom: 4
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mapInstance.current);

    return () => {
      if (mapInstance.current) {
        mapInstance.current.remove();
        mapInstance.current = null;
      }
    };
  }, [containerId]);

  return mapInstance;
}
2. Modifica칞칚o no IconSelector.tsx
typescript
// Atualize a fun칞칚o handleSetLocation
const handleSetLocation = () => {
  const mapContainer = document.getElementById('map-admin');
  if (!mapContainer) {
    console.error('Map container not found');
    return;
  }

  // Acessa a inst칙ncia existente do mapa
  const mapInstance = mapContainer._leaflet_id ? L.Map.get(mapContainer._leaflet_id) : null;
  
  if (!mapInstance) {
    console.error('Map instance not available');
    return;
  }

  try {
    // Adiciona o marcador ao mapa existente
    const marker = L.marker([latitude, longitude], {
      icon: L.divIcon({
        className: 'custom-marker',
        html: '游늸',
        iconSize: [30, 30]
      })
    }).addTo(mapInstance);

    // Centraliza o mapa no marcador
    mapInstance.setView([latitude, longitude], mapInstance.getZoom());

    // Limpa marcadores anteriores se necess치rio
    if (window.previousMarker) {
      mapInstance.removeLayer(window.previousMarker);
    }
    window.previousMarker = marker;

  } catch (error) {
    console.error('Error adding marker:', error);
  }
};
3. Atualiza칞칚o no Admin.tsx
typescript
// Use o hook personalizado no componente principal
const mapInstanceRef = useMapInstance('map-admin');

// Fun칞칚o para sele칞칚o de localiza칞칚o
const onLocationSelect = (lat: number, lng: number) => {
  if (!mapInstanceRef.current) {
    console.error('Map instance not available');
    return;
  }

  try {
    // Adiciona marcador tempor치rio
    const tempMarker = L.marker([lat, lng], {
      icon: L.divIcon({
        className: 'temp-marker',
        html: '游늸',
        iconSize: [30, 30]
      })
    }).addTo(mapInstanceRef.current);

    // Limpa marcador anterior se existir
    if (window.tempMarker) {
      mapInstanceRef.current.removeLayer(window.tempMarker);
    }
    window.tempMarker = tempMarker;

    // Centraliza o mapa
    mapInstanceRef.current.setView([lat, lng]);

  } catch (error) {
    console.error('Error adding marker:', error);
  }
};
4. Estilos Adicionais (opcional)
css
.custom-marker, .temp-marker {
  cursor: pointer;
  transition: transform 0.2s;
}

.custom-marker:hover {
  transform: scale(1.2);
}

.temp-marker {
  animation: pulse 0.5s 3;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}
Solu칞칚o Alternativa com React-Leaflet (Recomendada)
Se poss칤vel, migre para react-leaflet que gerencia automaticamente as inst칙ncias:

typescript
import { MapContainer, TileLayer, Marker, useMapEvents } from 'react-leaflet';

function LocationMarker({ onLocationSelect }: { onLocationSelect: (lat: number, lng: number) => void }) {
  const map = useMapEvents({
    click: (e) => {
      onLocationSelect(e.latlng.lat, e.latlng.lng);
    }
  });

  return null;
}

function AdminMap() {
  const [position, setPosition] = useState<[number, number] | null>(null);

  return (
    <MapContainer center={[-15.788, -47.879]} zoom={4} style={{ height: '100%', width: '100%' }}>
      <TileLayer url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png" />
      <LocationMarker onLocationSelect={(lat, lng) => setPosition([lat, lng])} />
      {position && <Marker position={position} />}
    </MapContainer>
  );
}
Dicas para Depura칞칚o
Verifique a exist칡ncia do container:

typescript
console.log('Map container exists:', !!document.getElementById('map-admin'));
Verifique a inst칙ncia do mapa:

typescript
const container = document.getElementById('map-admin');
console.log('Map instance exists:', container?._leaflet_id ? L.Map.get(container._leaflet_id) : null);
Verifique eventos do mapa:

typescript
mapInstance.on('click', (e) => console.log('Map click:', e.latlng));
Esta solu칞칚o deve resolver tanto o problema de acesso  inst칙ncia do mapa quanto a cria칞칚o duplicada, permitindo que voc칡 adicione marcadores corretamente.